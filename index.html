<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FixGo & Finish | Inicio</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-[#0a0a16] text-white">

    <!-- üîê HEADER / AUTH CONTROL -->
    <header class="p-6 flex justify-between items-center max-w-7xl mx-auto">
        <div class="text-2xl font-black tracking-tighter italic">FIXGO<span class="text-blue-500">&</span>FINISH</div>
        <div class="flex gap-4">
            <button id="btnLogin" class="text-gray-400 hover:text-white text-sm font-bold transition">Iniciar Sesi√≥n</button>
            <button id="btnLogout" class="hidden bg-red-500 hover:bg-red-600 px-6 py-2 rounded-full text-sm font-bold transition shadow-lg shadow-red-500/20">Cerrar Sesi√≥n</button>
        </div>
    </header>

    <main class="text-center py-16 px-6 max-w-5xl mx-auto">
        <h1 class="text-5xl md:text-7xl font-black mb-6 gradient-text">Mantenimiento de √âlite.</h1>
        <p class="text-gray-400 text-lg md:text-xl max-w-2xl mx-auto mb-10">
            T√©cnicos certificados y procesos blindados en el Caribe Mexicano.
        </p>

        <div class="flex flex-col md:flex-row gap-4 justify-center mb-12">
            <button id="solicitarServicioBtn" class="bg-white text-black px-8 py-4 rounded-2xl font-bold text-lg hover:bg-gray-200 transition shadow-xl">
                üõ† Solicitar Servicio
            </button>
            <button onclick="alert('üìç Nuestra Cobertura actual: Canc√∫n y Chetumal.')" class="glass border border-white/10 px-8 py-4 rounded-2xl font-bold text-lg hover:bg-white/5 transition">
                üìç Ver Cobertura
            </button>
        </div>

        <!-- LISTA DE SERVICIOS DEL CLIENTE -->
        <section id="serviciosCliente" class="hidden text-left">
            <h2 class="text-2xl font-bold mb-4">Tus Solicitudes</h2>
            <ul id="listaServicios" class="space-y-2">
                <!-- Se llenar√° din√°micamente -->
            </ul>
        </section>
    </main>

    <footer class="py-10 text-center text-gray-600 text-xs border-t border-white/5">
        ¬© 2026 FIXGO & FINISH | Quintana Roo, M√©xico.
    </footer>

    <!-- üîê AUTH + REDIRECCI√ìN -->
    <script type="module">
        import { app } from "./firebase-config.js";
        import { getAuth, onAuthStateChanged, signOut } from "./firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const auth = getAuth(app);
        const db = getFirestore(app);

        const btnLogin = document.getElementById("btnLogin");
        const btnLogout = document.getElementById("btnLogout");
        const solicitarBtn = document.getElementById("solicitarServicioBtn");
        const serviciosSection = document.getElementById("serviciosCliente");
        const listaServicios = document.getElementById("listaServicios");

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                btnLogin.classList.add("hidden");
                btnLogout.classList.remove("hidden");

                // Revisar rol
                const docRef = db.collection ? collection(db, "clientes") : null;
                if (!docRef) return;

                // Redirigir al bot√≥n seg√∫n rol
                solicitarBtn.onclick = () => window.location.href = "registro-cliente.html";

                // Mostrar servicios si es cliente
                try {
                    const serviciosQuery = query(collection(db, "servicios"), where("clienteUid", "==", user.uid));
                    const querySnapshot = await getDocs(serviciosQuery);
                    listaServicios.innerHTML = "";

                    if (querySnapshot.empty) {
                        listaServicios.innerHTML = "<li class='text-gray-400'>No tienes servicios solicitados a√∫n.</li>";
                    } else {
                        querySnapshot.forEach(doc => {
                            const data = doc.data();
                            listaServicios.innerHTML += `
                                <li class="bg-gray-800/40 p-4 rounded-lg shadow-sm">
                                    <p><strong>Servicio:</strong> ${data.tipo || "Desconocido"}</p>
                                    <p><strong>Estado:</strong> ${data.estado || "Pendiente"}</p>
                                    <p><strong>Fecha:</strong> ${new Date(data.fecha || Date.now()).toLocaleString()}</p>
                                </li>
                            `;
                        });
                    }
                    serviciosSection.classList.remove("hidden");
                } catch (error) {
                    console.error("Error cargando servicios:", error);
                }

            } else {
                btnLogin.classList.remove("hidden");
                btnLogout.classList.add("hidden");
                serviciosSection.classList.add("hidden");
                solicitarBtn.onclick = () => window.location.href = "login.html";
            }
        });

        btnLogin.onclick = () => window.location.href = "login.html";

        btnLogout.onclick = async () => {
            await signOut(auth);
            window.location.href = "login.html";
        };
    </script>

</body>
</html>

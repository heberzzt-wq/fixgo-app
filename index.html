<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FixGo - Cliente</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-slate-50 min-h-screen flex flex-col items-center p-4">

<!-- üîê PROTECCI√ìN LOGIN -->
<script type="module">
    import { auth, onAuthStateChanged, signOut } from "./firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { app } from "./firebase-config.js";

    const db = getFirestore(app);

    onAuthStateChanged(auth, async user => {
        if (!user) {
            window.location.href = "login.html";
            return;
        }

        try {
            const docRef = doc(db, "clientes", user.uid);
            const docSnap = await getDoc(docRef);

            if (!docSnap.exists() || docSnap.data().rol !== "CLIENTE") {
                alert("‚ùå Acceso denegado. No eres cliente.");
                await signOut(auth);
                window.location.href = "login.html";
                return;
            }

            document.getElementById("nombreCliente").innerText = docSnap.data().nombre || "Cliente";

        } catch (err) {
            console.error("Error verificando rol:", err);
            alert("‚ùå Error verificando permisos.");
            await signOut(auth);
            window.location.href = "login.html";
        }
    });
</script>

<!-- üßë‚Äçüíº PANEL CLIENTE -->
<div class="max-w-md w-full bg-white rounded-3xl shadow-2xl p-8 border border-slate-100">
    <h1 class="text-2xl font-black mb-4">Hola, <span id="nombreCliente">Cargando...</span></h1>

    <form id="solicitudForm" class="space-y-4">
        <div>
            <label class="block text-sm font-bold text-slate-700 mb-1">Direcci√≥n / Colonia</label>
            <input type="text" name="direccion" required placeholder="D√≥nde necesitas el servicio?"
                class="w-full px-4 py-3 border rounded-xl outline-none">
        </div>

        <div>
            <label class="block text-sm font-bold text-slate-700 mb-1">Tel√©fono de contacto</label>
            <input type="tel" name="telefono" required placeholder="WhatsApp o Celular"
                class="w-full px-4 py-3 border rounded-xl outline-none">
        </div>

        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl">
            Solicitar Servicio
        </button>
    </form>

    <h2 class="mt-6 font-bold text-slate-700">Solicitudes Pendientes</h2>
    <div id="solicitudesCliente" class="mt-4 space-y-2"></div>

    <button id="cerrarSesionCliente" class="mt-6 w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-xl">
        Cerrar Sesi√≥n
    </button>
</div>

<!-- ‚öôÔ∏è JS CLIENTE -->
<script type="module" src="app-cliente.js"></script>

</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FixGo - Panel Administrativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <!-- ðŸ§‘â€ðŸ’¼ PANEL ADMIN -->
    <div id="panelAdmin" data-rol="ADMIN" class="max-w-2xl w-full bg-gray-800/50 backdrop-blur-xl border border-white/10 p-8 rounded-[2rem] shadow-2xl text-center">
        <div class="mb-6">
            <div class="w-24 h-24 bg-indigo-600 rounded-full mx-auto flex items-center justify-center text-4xl shadow-lg shadow-indigo-500/20">
                <i class="fas fa-user-cog"></i>
            </div>
            <h1 id="nombreAdmin" class="text-3xl font-black mt-4">Cargando...</h1>
            <p class="text-gray-400 text-sm uppercase tracking-widest">
                Panel Administrativo
            </p>
        </div>

        <div class="grid gap-4">
            <button onclick="verTecnicos()" class="group bg-blue-600/10 border border-blue-500/20 p-6 rounded-3xl hover:bg-blue-600 transition-all duration-300">
                <i class="fas fa-users text-blue-500 group-hover:text-white text-2xl mb-2"></i>
                <span class="block font-bold group-hover:text-white">GestiÃ³n de TÃ©cnicos</span>
            </button>

            <button onclick="verClientes()" class="group bg-green-600/10 border border-green-500/20 p-6 rounded-3xl hover:bg-green-600 transition-all duration-300">
                <i class="fas fa-user-check text-green-500 group-hover:text-white text-2xl mb-2"></i>
                <span class="block font-bold group-hover:text-white">GestiÃ³n de Clientes</span>
            </button>

            <button onclick="verServicios()" class="group bg-orange-500/10 border border-orange-500/20 p-6 rounded-3xl hover:bg-orange-500 transition-all duration-300">
                <i class="fas fa-tools text-orange-500 group-hover:text-white text-2xl mb-2"></i>
                <span class="block font-bold group-hover:text-white">Servicios</span>
            </button>
        </div>

        <p class="mt-8 text-[10px] text-gray-500 font-bold uppercase tracking-widest">
            FixGo Admin v2.0
        </p>
    </div>

    <!-- ðŸ” PROTECCIÃ“N LOGIN + VERIFICACIÃ“N DE ROL -->
    <script type="module">
        import { auth, onAuthStateChanged } from "./firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { app } from "./firebase-config.js";

        const db = getFirestore(app);

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                // No hay sesiÃ³n, redirigir a login
                window.location.href = "login.html";
                return;
            }

            try {
                // Verificar rol desde Firestore
                const docRef = doc(db, "admins", user.uid);
                const docSnap = await getDoc(docRef);

                if (!docSnap.exists() || docSnap.data().rol !== "ADMIN") {
                    alert("âŒ Acceso denegado. No tienes permisos de administrador.");
                    await auth.signOut();
                    window.location.href = "login.html";
                    return;
                }

                // Mostrar info del admin
                const data = docSnap.data();
                document.getElementById("nombreAdmin").innerText = data.nombre || "Administrador";

            } catch (error) {
                console.error("Error verificando rol:", error);
                alert("âŒ Error verificando permisos.");
                await auth.signOut();
                window.location.href = "login.html";
            }
        });

        // Funciones dummy de botones, reemplazar con lÃ³gica real
        window.verTecnicos = () => alert("ðŸ“‹ Gestionar tÃ©cnicos");
        window.verClientes = () => alert("ðŸ‘¥ Gestionar clientes");
        window.verServicios = () => alert("ðŸ›  Gestionar servicios");
    </script>

    <!-- âš™ï¸ JS ADMIN -->
    <script type="module" src="app-admin.js"></script>

</body>
</html>
